@model Roulette.Models.TableModel

@{
    ViewBag.Title = "Roulette Admin";
}

@section Head
{
    <script src="@Url.Content("~/Scripts/jquery-1.7.2.min.js")" type="text/javascript"></script>
     <script type="text/javascript" src="/Scripts/jquery-ui-1.8.11.js"></script>
     <link rel="stylesheet" href="http://code.jquery.com/ui/1.8.21/themes/base/jquery-ui.css" type="text/css" media="all" />
     <script type="text/javascript" src="/Scripts/Custom/highlighter.js"></script>
     <script type="text/javascript" src="/Scripts/Custom/stake.js"></script>
     <script type="text/javascript">
       var contractNumber= 0;
         function getStakes() {
             setTimeout(function () {
                 $.ajax({
                     type: "POST",
                     url: '/Stake/GetStakes',
                     dataType: 'html',
                     success: function (stakesList) {
                         if (stakesList == "") {
                             $('.roulette-board div.chip').remove();
                             $('#zero div.chip').remove();
                             stakes = new Array();
                         }
                         getStakes();
                     }
                 });
             }, 400);
         }

         function setRoundNumber() {
             setTimeout(function () {
                 getRoundNumber();
                 setRoundNumber();
             }, 2000);
         }

         $(function () {
             $('#check-dialog, #pay-dialog').dialog({
                 modal: true,
                 autoOpen: false,
                 width: 300,
                 height: 200,
                 title: "Check code",
                 open: function (event, ui) {

                 },
                 close: function (event, ui) {
                 }
             });
             $("#pay-dialog").dialog({ title: "Pay Winners" });
             $("#check-button").click(function () {
                 $("#check-dialog").dialog("open");
             });

             $("#check-botton-dialog").click(function () {
                 $.post("/Stake/CheckWinner", { barCode: $(".code-textbox").val() }, function (data) {
                     if (data.isWinner) {
                         $("#hiddenTextBox").val($(".code-textbox").val());
                         $("#pay").show();
                     }
                     else {
                         $("#pay").hide();
                     }
                     $(this).parent().parent().dialog("close");
                     $("#paySum").html(data.winning);
                     $(".code-textbox").val("");
                     $("#pay-dialog").dialog("open");

                 });
             });

             $(".cancel-botton-dialog").click(function () {
                 $(this).parent().parent().dialog("close");
             });

             $("#pay").click(function () {
                 $.post("/Stake/PayWinner", { barCode: $("#hiddenTextBox").val() }, function (data) {
                     if (data.isPayed) {
                         alert("Ok");
                     }
                     else {
                         alert("Error according when executing this query. Please try later.");
                     }
                 });

                 $(this).parent().parent().dialog("close");
             });

             $.ajax({
                 type: "POST",
                 url: '/Stake/RememberCurrentState',
                 data: { currentState: "" }
             });

             $("#cancel-button").click(function () {
                 $.ajax({
                     type: "POST",
                     url: '/Stake/RememberCurrentState',
                     data: { currentState: "" },
                     success: function () {
                         stakes = new Array();
                         $('.roulette-board div.chip').remove();
                         $('#zero div.chip').remove();
                     }
                 });
             });

             $("#submit-button").click(function () {
                 $.ajax({
                     type: "POST",
                     url: '/Stake/CreateStake',
                     contentType: 'application/json',
                     data: JSON.stringify(stakes),
                     async: false,
                     success: function (data) {
                         stakes = new Array();
                         $('.roulette-board div.chip').remove();
                         $('#zero div.chip').remove();
                         contractNumber = data.contractNumber;
                         PrintCheck(contractNumber);
                     }
                 });
             });


             getStakes();
             setRoundNumber();
             setProgressBar();
         });
         function PrintCheck(contractNumber) {
             if (contractNumber != 0) {
                 window.open("/Stake/Check?contractNumber=" + contractNumber, "_blank");
             }

         }
     </script>
}

<div id="admin-board">

    <div id="buttons">
        <input type="button" value="Clear" id="cancel-button" class="admin-button"/>
        <input type="button" value="Submit" id="submit-button" class="admin-button" />
        <input type="button" value="Check" id="check-button" class="admin-button" />
    </div>
    <div id="centered-div">
        @Html.Partial("_Board", Model)
    </div>
    <div class="roulette-chips">
        <div class="chip" data-value="1">
            <img src="/img/red-chip.png" alt="1"/>
            <div class="text">1</div>
        </div>
        <div class="chip" data-value="2">
            <img src="/img/purple-chip.png" alt="2"/>
            <div class="text">2</div>
        </div>
        <div class="chip" data-value="5">
            <img src="/img/blue-chip.png" alt="5"/>
            <div class="text">5</div>
        </div>
        <div class="chip" data-value="10">
            <img src="/img/orange-chip.png" alt="10"/>
            <div class="text">10</div>
        </div>
    </div>
</div>
<div id="check-dialog">
 <input type="text" class="code-textbox" />
 <div class="check-dialog-buttons">
     <input type="button" value="Check" class="admin-button" id="check-botton-dialog"/>
     <input type="button" value="Cancel" class="admin-button cancel-botton-dialog" />
 </div>
</div>

<div id="pay-dialog">
 <label id="paySum"></label>
 <input type="hidden" id="hiddenTextBox" />
 <div class="check-dialog-buttons">
     <input type="button" value="Pay" class="admin-button" id="pay"/>
     <input type="button"value="Cancel" class="admin-button cancel-botton-dialog" />
 </div>
</div>